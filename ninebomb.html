<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>-NINE Büí£MB-</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #222;
  color: #fff;
  margin: 0;
  padding: 0;
}
h1 {
  font-size: calc(20px + 2vw);
  margin-top: 10px;
}
#grid-container {
  width: 90vw;
  max-width: 300px;
  margin: 10px auto;
}
#grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 5px;
  width: 100%;
  height: 0;
}
.cell {
  background: #ccc;
  border-radius: 8px;
  transition: background 0.2s;
}
#stats {
  margin-top: 10px;
  font-size: calc(14px + 0.5vw);
}
#controls {
  display: flex;
  justify-content: space-around;
  align-items: flex-start;
  margin-top: 15px;
  max-width: 360px;
  margin-left: auto;
  margin-right: auto;
}
#dpad {
  display: grid;
  grid-template-columns: repeat(3, 60px);
  grid-template-rows: repeat(3, 60px);
  gap: 5px;
}
.control-btn {
  background: #2196F3;
  border: none;
  border-radius: 10px;
  color: #fff;
  font-size: 1.5em;
}
.control-btn.blank {
  background: transparent;
}
#bombBtn {
  width: 90px;
  height: 90px;
  background: #ff4d4d; /* Êòé„Çã„ÅÑËµ§ */
  border: none;
  border-radius: 15px;
  color: white;
  font-size: 1.2em;
}
#status {
  margin-top: 10px;
  font-size: calc(16px + 0.5vw);
}
</style>
</head>
<body>
<h1>-NINE Büí£MB-</h1>

<div id="grid-container">
  <div id="grid"></div>
</div>

<div id="stats">Âãù„Å°: 0„ÄÄË≤†„Åë: 0„ÄÄÈÄ£Âãù: 0</div>

<div id="controls">
  <div id="dpad">
    <button class="control-btn blank"></button>
    <button class="control-btn" data-dir="up">‚Üë</button>
    <button class="control-btn blank"></button>
    <button class="control-btn" data-dir="left">‚Üê</button>
    <button class="control-btn blank"></button>
    <button class="control-btn" data-dir="right">‚Üí</button>
    <button class="control-btn blank"></button>
    <button class="control-btn" data-dir="down">‚Üì</button>
    <button class="control-btn blank"></button>
  </div>
  <button id="bombBtn">üí£</button>
</div>

<div id="status"></div>

<script>
const gridSize = 3;
let playerPos = {x:2, y:2};
let enemyPos = {x:0, y:0};
let bombPositions = [];
let gameOver = false;
let gameStarted = false;
let enemyPause = false;
let moveInterval;
let wins = 0, losses = 0, streak = 0;

const grid = document.getElementById("grid");
const statusDiv = document.getElementById("status");
const statsDiv = document.getElementById("stats");

function resizeGrid(){
  const w = grid.offsetWidth;
  grid.style.height = w + "px";
}
window.addEventListener("load", resizeGrid);
window.addEventListener("resize", resizeGrid);

function createGrid(){
  grid.innerHTML="";
  for(let i=0;i<gridSize*gridSize;i++){
    const c=document.createElement("div");
    c.className="cell";
    grid.appendChild(c);
  }
  render();
}

function render(){
  const cells=document.querySelectorAll(".cell");
  cells.forEach(c=>c.style.background="#ccc");

  bombPositions.forEach(b=>{
    const idx=b.y*gridSize+b.x;
    cells[idx].style.background="#FFEB3B";
  });

  const pIdx=playerPos.y*gridSize+playerPos.x;
  const eIdx=enemyPos.y*gridSize+enemyPos.x;
  cells[eIdx].style.background="#E91E63";
  cells[pIdx].style.background="#4CAF50";
}

function movePlayer(dir){
  if(!gameStarted || gameOver) return;
  let nx=playerPos.x, ny=playerPos.y;
  if(dir==="up") ny--;
  if(dir==="down") ny++;
  if(dir==="left") nx--;
  if(dir==="right") nx++;
  if(nx>=0 && nx<gridSize && ny>=0 && ny<gridSize){
    if(!bombPositions.some(b=>b.x===nx&&b.y===ny)){
      playerPos={x:nx,y:ny};
    }
  }
  render();
}

function placeBomb(pos=playerPos){
  if(!gameStarted || gameOver) return;
  if(bombPositions.some(b=>b.x===pos.x&&b.y===pos.y)) return;
  bombPositions.push({...pos});
  render();

  // Êïµ„ÅÆÂõûÈÅøË°åÂãï
  if(pos.x===enemyPos.x && pos.y===enemyPos.y){
    enemyPause=true;
    moveEnemySafe(2);
  }

  setTimeout(()=>explode(pos.x,pos.y),600);
}

function explode(x,y){
  const cells=document.querySelectorAll(".cell");
  const dirs=[[0,0],[-1,0],[1,0],[0,-1],[0,1]];
  dirs.forEach(([dx,dy])=>{
    const r=y+dy, c=x+dx;
    if(r>=0&&r<gridSize&&c>=0&&c<gridSize){
      const idx=r*gridSize+c;
      cells[idx].style.background="#FFFF33"; // ‚Üê Êòé„Çã„ÅèÂ§âÊõ¥ÔºÅ
    }
  });

  if(dirs.some(([dx,dy])=>playerPos.x===x+dx && playerPos.y===y+dy)){
    gameOver=true; streak=0; losses++;
    statusDiv.textContent="game over";
  }
  if(dirs.some(([dx,dy])=>enemyPos.x===x+dx && enemyPos.y===y+dy)){
    gameOver=true; wins++; streak++;
    statusDiv.textContent="nice game!";
  }

  setTimeout(()=>{
    bombPositions=bombPositions.filter(b=>!(b.x===x&&b.y===y));
    render();
    statsDiv.textContent=`Âãù„Å°: ${wins}„ÄÄË≤†„Åë: ${losses}„ÄÄÈÄ£Âãù: ${streak}`;
    if(gameOver){
      playerPos={x:2,y:2};
      enemyPos={x:0,y:0};
      bombPositions=[];
      render();
      gameStarted=false;
    }
  },100);
}

function moveEnemy(){
  if(gameOver || enemyPause || !gameStarted) return;
  const dirs=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}].sort(()=>Math.random()-0.5);
  for(let d of dirs){
    let nx=enemyPos.x+d.x, ny=enemyPos.y+d.y;
    if(nx>=0 && nx<gridSize && ny>=0 && ny<gridSize){
      if(!bombPositions.some(b=>b.x===nx&&b.y===ny)){
        enemyPos={x:nx,y:ny};
        if(Math.random()<0.3) placeBomb(enemyPos);
        break;
      }
    }
  }
  render();
}

function moveEnemySafe(steps){
  if(steps<=0){ enemyPause=false; return; }
  const dirs=[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}].sort(()=>Math.random()-0.5);
  for(let d of dirs){
    let nx=enemyPos.x+d.x, ny=enemyPos.y+d.y;
    if(nx>=0 && nx<gridSize && ny>=0 && ny<gridSize && !bombPositions.some(b=>b.x===nx&&b.y===ny)){
      enemyPos={x:nx,y:ny};
      render();
      setTimeout(()=>moveEnemySafe(steps-1),200);
      return;
    }
  }
}

document.getElementById("bombBtn").addEventListener("click",()=>{
  if(!gameStarted){
    gameStarted=true;
    statusDiv.textContent="";
    moveInterval=setInterval(moveEnemy,400);
  }else{
    placeBomb();
  }
});

document.querySelectorAll(".control-btn").forEach(btn=>{
  btn.addEventListener("click",()=>movePlayer(btn.dataset.dir));
});

document.addEventListener("keydown",e=>{
  if(e.key===" "){ placeBomb(); }
  if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){
    movePlayer(e.key.replace("Arrow","").toLowerCase());
  }
});

createGrid();
</script>
</body>
</html>
